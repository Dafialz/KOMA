<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Служба підтримки — КОМА</title>
  <meta name="description" content="Напишіть у службу підтримки «КОМА». Ми відповімо якнайшвидше." />
  <link rel="icon" href="icon/favicon.ico" type="image/x-icon" />
  <meta name="theme-color" content="#0f5257" />
  <link rel="stylesheet" href="css/main.css" />
</head>
<body>
  <!-- header/footer через partials -->
  <div data-include="partials/header.html"></div>

  <main class="section">
    <div class="container" style="max-width:980px">
      <h1 style="margin:0 0 14px">Служба підтримки</h1>
      <p class="lead">Опишіть проблему чи запит. Ми відповімо на вказану вами електронну пошту.</p>

      <!-- Простий клієнтський «чат/форма» (крок 1). 
           Наступним кроком підв’яжемо адмінський інтерфейс для відповідей. -->
      <form id="supportForm" class="card" style="padding:22px;margin-top:14px">
        <div class="grid grid-2">
          <div>
            <label>Ваше ім’я</label>
            <input id="sup_name" class="input" type="text" placeholder="Ім’я" required>
          </div>
          <div>
            <label>Ел. пошта</label>
            <input id="sup_email" class="input" type="email" placeholder="you@example.com" required>
          </div>

          <div>
            <label>Тема</label>
            <select id="sup_topic" class="input">
              <option value="Технічна проблема">Технічна проблема</option>
              <option value="Питання по запису">Питання по запису</option>
              <option value="Оплата">Оплата</option>
              <option value="Інше">Інше</option>
            </select>
          </div>

          <div>
            <label>Пріоритет</label>
            <select id="sup_priority" class="input">
              <option value="Звичайний">Звичайний</option>
              <option value="Високий">Високий</option>
              <option value="Терміновий">Терміновий</option>
            </select>
          </div>

          <div class="col-span-2">
            <label>Повідомлення</label>
            <textarea id="sup_message" class="input" rows="5" placeholder="Опишіть ситуацію максимально конкретно…" required></textarea>
            <p class="hint">Натискаючи «Надіслати», ви погоджуєтеся на обробку персональних даних, необхідну для відповіді.</p>
          </div>
        </div>

        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:14px">
          <button type="reset" class="btn outline">Очистити</button>
          <button id="sup_send" type="submit" class="btn">Надіслати</button>
        </div>

        <div id="sup_ok" class="ok" role="status" style="display:none;margin-top:12px">
          Дякуємо! Ми зв’яжемося з вами найближчим часом.
        </div>
        <div id="sup_err" class="error" role="alert" style="display:none;margin-top:12px">
          На жаль, не вдалося надіслати. Спробуйте ще раз.
        </div>
      </form>

      <!-- Локальний лог звернень (видимий тільки вам на цьому пристрої) -->
      <section style="margin-top:22px">
        <h2 style="margin:0 0 10px">Останні звернення (локально)</h2>
        <div id="sup_log" class="card" style="padding:14px"></div>
      </section>
    </div>
  </main>

  <div data-include="partials/footer.html"></div>

  <!-- scripts -->
  <script src="js/partials.js"></script>
  <script>
    // Дуже просте надсилання + локальний лог (крок 1)
    (function(){
      const form = document.getElementById('supportForm');
      const ok   = document.getElementById('sup_ok');
      const err  = document.getElementById('sup_err');
      const log  = document.getElementById('sup_log');

      function addLocal(item){
        try{
          const all = JSON.parse(localStorage.getItem('koma_support_log')||'[]');
          all.unshift(item);
          localStorage.setItem('koma_support_log', JSON.stringify(all.slice(0,20)));
          render();
        }catch{}
      }
      function render(){
        try{
          const all = JSON.parse(localStorage.getItem('koma_support_log')||'[]');
          log.innerHTML = all.length ? all.map(x => (
            `<div class="event" style="margin:8px 0">
              <strong>${x.name}</strong> &lt;${x.email}&gt; — <em>${x.topic}</em>
              <div class="small">${new Date(x.ts).toLocaleString('uk-UA')}</div>
              <div>${x.message.replace(/</g,'&lt;')}</div>
            </div>`
          )).join('') : '<div class="muted">Поки що немає записів.</div>';
        }catch{ log.innerHTML = ''; }
      }
      render();

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        ok.style.display='none'; err.style.display='none';

        const payload = {
          name: document.getElementById('sup_name').value.trim(),
          email: document.getElementById('sup_email').value.trim(),
          topic: document.getElementById('sup_topic').value,
          priority: document.getElementById('sup_priority').value,
          message: document.getElementById('sup_message').value.trim()
        };
        if(!payload.name || !payload.email || !payload.message){
          err.style.display='block'; return;
        }

        // Крок 1: фолбек — просто зберігаємо локально і показуємо "Ок".
        // (Крок 2 зробимо бекенд/адмін-відповіді.)
        addLocal({ ...payload, ts: Date.now() });
        ok.style.display='block';
        form.reset();

        // Якщо у вас уже є ендпоінт — можна розкоментувати:
        // try{
        //   const r = await fetch('/api/support', {
        //     method:'POST', headers:{'Content-Type':'application/json'},
        //     body: JSON.stringify(payload)
        //   });
        //   if(!r.ok) throw new Error();
        //   ok.style.display='block';
        // }catch{ err.style.display='block'; }
      });
    })();
  </script>
</body>
</html>
